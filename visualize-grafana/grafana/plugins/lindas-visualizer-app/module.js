define(["@grafana/data","react","@grafana/ui","@emotion/css"],function(e,t,n,a){return function(){"use strict";var r={7:function(e){e.exports=n},89:function(e){e.exports=a},781:function(t){t.exports=e},959:function(e){e.exports=t}},s={};function i(e){var t=s[e];if(void 0!==t)return t.exports;var n=s[e]={exports:{}};return r[e](n,n.exports,i),n.exports}i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,{a:t}),t},i.d=function(e,t){for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var c={};i.r(c),i.d(c,{plugin:function(){return S}});var o=i(781),l=i(959),u=i.n(l),m=i(7),p=i(89);async function d(e){const t=await fetch("https://lindas.admin.ch/query",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/sparql-results+json"},body:new URLSearchParams({query:e})});if(!t.ok)throw new Error(`SPARQL failed: ${t.statusText}`);return t.json()}async function b(e=100){const t=`\n    PREFIX schema: <http://schema.org/>\n    PREFIX cube: <https://cube.link/>\n    SELECT DISTINCT ?cube ?title ?description WHERE {\n      ?cube a cube:Cube .\n      ?cube schema:name ?title .\n      FILTER(LANG(?title) = "en" || LANG(?title) = "de" || LANG(?title) = "")\n      OPTIONAL { ?cube schema:description ?description }\n    }\n    LIMIT ${e}\n  `;return(await d(t)).results.bindings.map(e=>({iri:e.cube.value,title:e.title?.value||"Untitled",description:e.description?.value}))}const g=e=>({container:p.css`max-width: 1200px;`,header:p.css`margin-bottom: ${e.spacing(3)};`,title:p.css`margin: 0; color: ${e.colors.text.primary};`,searchBox:p.css`display: flex; gap: ${e.spacing(2)}; margin-bottom: ${e.spacing(3)};`,grid:p.css`display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: ${e.spacing(2)};`,card:p.css`cursor: pointer; &:hover { box-shadow: ${e.shadows.z2}; }`,loading:p.css`display: flex; justify-content: center; padding: ${e.spacing(4)};`}),E=({onSelectCube:e})=>{const t=(0,m.useStyles2)(g),[n,a]=(0,l.useState)([]),[r,s]=(0,l.useState)(!0),[i,c]=(0,l.useState)(null),[o,p]=(0,l.useState)("");(0,l.useEffect)(()=>{b(100).then(a).catch(e=>c(e.message)).finally(()=>s(!1))},[]);const E=async()=>{if(!o.trim())return s(!0),void b(100).then(a).finally(()=>s(!1));s(!0),async function(e,t=50){const n=`\n    PREFIX schema: <http://schema.org/>\n    PREFIX cube: <https://cube.link/>\n    SELECT DISTINCT ?cube ?title WHERE {\n      ?cube a cube:Cube .\n      ?cube schema:name ?title .\n      FILTER(CONTAINS(LCASE(STR(?title)), LCASE("${e}")))\n    }\n    LIMIT ${t}\n  `;return(await d(n)).results.bindings.map(e=>({iri:e.cube.value,title:e.title?.value||"Untitled"}))}(o,50).then(a).catch(e=>c(e.message)).finally(()=>s(!1))};return u().createElement("div",{className:t.container},u().createElement("div",{className:t.header},u().createElement("h2",{className:t.title},"Browse LINDAS Datasets")),u().createElement("div",{className:t.searchBox},u().createElement(m.Input,{placeholder:"Search datasets...",value:o,onChange:e=>p(e.currentTarget.value),onKeyPress:e=>"Enter"===e.key&&E(),prefix:u().createElement(m.Icon,{name:"search"})}),u().createElement(m.Button,{onClick:E},"Search")),i&&u().createElement(m.Alert,{title:"Error",severity:"error"},i),r?u().createElement("div",{className:t.loading},u().createElement(m.Spinner,{size:"xl"})):u().createElement("div",{className:t.grid},n.map(n=>u().createElement(m.Card,{key:n.iri,className:t.card,onClick:()=>e(n.iri)},u().createElement(m.Card.Heading,null,n.title),n.description&&u().createElement(m.Card.Description,null,n.description)))))},h=e=>({container:p.css`max-width: 800px;`,section:p.css`background: ${e.colors.background.secondary}; padding: ${e.spacing(3)}; margin-bottom: ${e.spacing(3)}; border-radius: ${e.shape.radius.default};`,sectionTitle:p.css`margin: 0 0 ${e.spacing(2)} 0;`,chips:p.css`display: flex; flex-wrap: wrap; gap: ${e.spacing(1)};`,chip:p.css`padding: ${e.spacing(.5)} ${e.spacing(1)}; border-radius: 16px; cursor: pointer; border: 1px solid ${e.colors.border.weak};`,chipSelected:p.css`background: ${e.colors.primary.main}; color: white;`,queryBox:p.css`font-family: monospace; padding: ${e.spacing(2)}; background: ${e.colors.background.primary}; white-space: pre-wrap; max-height: 200px; overflow: auto;`,actions:p.css`display: flex; gap: ${e.spacing(2)}; margin-top: ${e.spacing(2)};`,loading:p.css`display: flex; justify-content: center; padding: ${e.spacing(4)};`,noCube:p.css`text-align: center; padding: ${e.spacing(4)};`}),f=({cubeIri:e,onBack:t})=>{const n=(0,m.useStyles2)(h),[a,r]=(0,l.useState)([]),[s,i]=(0,l.useState)(!1),[c,o]=(0,l.useState)(null),[p,b]=(0,l.useState)([]),[g,E]=(0,l.useState)([]);(0,l.useEffect)(()=>{e&&(i(!0),async function(e){const t=`\n    PREFIX schema: <http://schema.org/>\n    PREFIX cube: <https://cube.link/>\n    PREFIX sh: <http://www.w3.org/ns/shacl#>\n    SELECT DISTINCT ?dimension ?label WHERE {\n      <${e}> cube:observationConstraint/sh:property ?prop .\n      ?prop sh:path ?dimension .\n      OPTIONAL { ?dimension schema:name ?label }\n    }\n  `;try{return(await d(t)).results.bindings.map(e=>({iri:e.dimension.value,label:e.label?.value||e.dimension.value.split("/").pop()||"Unknown",type:/year|date|time/i.test(e.label?.value||"")?"temporal":"dimension"}))}catch{return[]}}(e).then(e=>{r(e);const t=e.find(e=>"temporal"===e.type),n=e.find(e=>"measure"===e.type);t&&b([t.iri]),n&&E([n.iri])}).catch(e=>o(e.message)).finally(()=>i(!1)))},[e]);const f=(e,t)=>{(t?E:b)(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])};if(!e)return u().createElement("div",{className:n.noCube},u().createElement(m.Icon,{name:"info-circle",size:"xxl"}),u().createElement("h3",null,"No Dataset Selected"),u().createElement(m.Button,{onClick:t},"Browse Datasets"));if(s)return u().createElement("div",{className:n.loading},u().createElement(m.Spinner,{size:"xl"}));const y=function(e,t,n){const a=["?obs",...t.map((e,t)=>`?d${t}`),...n.map((e,t)=>`?m${t}`)],r=["?obs a cube:Observation .",`?obs cube:observedBy <${e}> .`];return t.forEach((e,t)=>r.push(`OPTIONAL { ?obs <${e}> ?d${t} . }`)),n.forEach((e,t)=>r.push(`OPTIONAL { ?obs <${e}> ?m${t} . }`)),`PREFIX cube: <https://cube.link/>\nSELECT ${a.join(" ")}\nWHERE {\n  ${r.join("\n  ")}\n}`}(e,p,g),v=a.filter(e=>"measure"!==e.type),S=a.filter(e=>"measure"===e.type);return u().createElement("div",{className:n.container},u().createElement(m.Button,{variant:"secondary",onClick:t},u().createElement(m.Icon,{name:"arrow-left"})," Back"),c&&u().createElement(m.Alert,{title:"Error",severity:"error"},c),u().createElement("div",{className:n.section},u().createElement("h3",{className:n.sectionTitle},"Dimensions"),u().createElement("div",{className:n.chips},v.map(e=>u().createElement("span",{key:e.iri,className:`${n.chip} ${p.includes(e.iri)?n.chipSelected:""}`,onClick:()=>f(e.iri,!1)},e.label)))),u().createElement("div",{className:n.section},u().createElement("h3",{className:n.sectionTitle},"Measures"),u().createElement("div",{className:n.chips},S.map(e=>u().createElement("span",{key:e.iri,className:`${n.chip} ${g.includes(e.iri)?n.chipSelected:""}`,onClick:()=>f(e.iri,!0)},e.label)))),u().createElement("div",{className:n.section},u().createElement("h3",{className:n.sectionTitle},"SPARQL Query"),u().createElement("pre",{className:n.queryBox},y),u().createElement("div",{className:n.actions},u().createElement(m.ClipboardButton,{getText:()=>y,variant:"secondary"},"Copy"))))},y=e=>({container:p.css`
    padding: ${e.spacing(2)};
  `}),v=e=>({container:p.css`max-width: 600px;`}),S=(new o.AppPlugin).setRootPage(e=>{const t=(0,m.useStyles2)(y),[n,a]=(0,l.useState)("browse"),[r,s]=(0,l.useState)(null);return u().createElement("div",{className:t.container},u().createElement(m.TabsBar,null,u().createElement(m.Tab,{label:"Browse Datasets",active:"browse"===n,onChangeTab:()=>a("browse")}),u().createElement(m.Tab,{label:"Create Chart",active:"create"===n,onChangeTab:()=>a("create"),counter:r?1:void 0})),u().createElement(m.TabContent,null,"browse"===n&&u().createElement(E,{onSelectCube:e=>{s(e),a("create")}}),"create"===n&&u().createElement(f,{cubeIri:r,onBack:()=>a("browse")})))}).addConfigPage({title:"Configuration",icon:"cog",body:({plugin:e})=>{const t=(0,m.useStyles2)(v);return u().createElement("div",{className:t.container},u().createElement(m.Alert,{title:"LINDAS Visualizer",severity:"info"},"Browse and visualize datasets from LINDAS. No configuration required."))},id:"configuration"});return c}()});